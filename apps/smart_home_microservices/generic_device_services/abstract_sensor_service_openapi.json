{"openapi":"3.1.0","info":{"title":"Абстрактный сервис работы с датчиками и устройствами","version":"0.1.0"},"paths":{"/all_devices":{"get":{"summary":"Get Devices","description":"Вернуть список всех устройств, сопровождаемых этим роутером","operationId":"get_devices_all_devices_get","parameters":[{"name":"available_only","in":"query","required":false,"schema":{"type":"boolean","default":true,"title":"Available Only"}},{"name":"active_only","in":"query","required":false,"schema":{"type":"boolean","default":false,"title":"Active Only"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/DeviceInfo"},"title":"Response Get Devices All Devices Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/device/create":{"post":{"summary":"Create Device","description":"Создать устройство","operationId":"create_device_device_create_post","requestBody":{"content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Params"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeviceInfo"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/device/{device_id}/info":{"get":{"summary":"Get Device","description":"Вернуть информацию об устройстве","operationId":"get_device_device__device_id__info_get","parameters":[{"name":"device_id","in":"path","required":true,"schema":{"type":"integer","title":"Device Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeviceInfo"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/device/{device_id}/measure":{"get":{"summary":"Measure Once","description":"Провести однократное измерение на датчике","operationId":"measure_once_device__device_id__measure_get","parameters":[{"name":"device_id","in":"path","required":true,"schema":{"type":"integer","title":"Device Id"}},{"name":"sample_format","in":"query","required":true,"schema":{"$ref":"#/components/schemas/TelemetrySampleFormat"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TelemetrySampleInfo"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/device/{device_id}/create_measurement_process":{"post":{"summary":"Create Measurement Process","description":"Начать процесс регулярных измерений на датчике","operationId":"create_management_process","parameters":[{"name":"device_id","in":"path","required":true,"schema":{"type":"integer","title":"Device Id"}}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Body_create_management_process"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MeasurementProcessInfo"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/measurement_process/{meas_proc_id}/stop":{"put":{"summary":"Stop Measurement Process","description":"Остановить запущенныйпроцесс регулярных измерений","operationId":"stop_measurement_process_measurement_process__meas_proc_id__stop_put","parameters":[{"name":"meas_proc_id","in":"path","required":true,"schema":{"type":"integer","title":"Meas Proc Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/device/{device_id}/measurement_processes":{"get":{"summary":"Get Measurement Processes","description":"Вернуть все процессы измерений на датчике (с возможностью фильтрации 'только активные')","operationId":"get_measurement_processes_device__device_id__measurement_processes_get","parameters":[{"name":"device_id","in":"path","required":true,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Device Id"}},{"name":"active_only","in":"query","required":false,"schema":{"type":"boolean","default":false,"title":"Active Only"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/MeasurementProcessInfo"},"title":"Response Get Measurement Processes Device  Device Id  Measurement Processes Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/measurement_process/{meas_proc_id}":{"get":{"summary":"Get Measurement Process","description":"Вернуть информацию об отдельном процессе измерений по его ID","operationId":"get_measurement_process_measurement_process__meas_proc_id__get","parameters":[{"name":"meas_proc_id","in":"path","required":true,"schema":{"type":"integer","title":"Meas Proc Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MeasurementProcessInfo"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/health_check":{"get":{"summary":"Health Check","description":"Проверка состояния сервиса","operationId":"health_check_health_check_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Response Health Check Health Check Get"}}}}}}},"/device/create/params":{"get":{"summary":"Get Device Creation Params","description":"Вернуть словарь параметров для создания устройства (имена параметров, типы данных, обязательность и т.д.)","operationId":"get_device_creation_params_device_create_params_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":{"$ref":"#/components/schemas/DeviceParamInfo"},"type":"object","title":"Response Get Device Creation Params Device Create Params Get"}}}}}}},"/device/{device_id}/active/{is_active}":{"put":{"summary":"Set Device Active","description":"Активировать/деактивировать устройство","operationId":"set_device_active_device__device_id__active__is_active__put","parameters":[{"name":"device_id","in":"path","required":true,"schema":{"type":"integer","title":"Device Id"}},{"name":"is_active","in":"path","required":true,"schema":{"type":"boolean","title":"Is Active"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/device/{device_id}/health_check_interval/{interval}":{"put":{"summary":"Set Device Health Check Interval","description":"Установить интервал автопроверки состояния устройства.\nget_health_check_interval отдельно не делаем, его и в get_device_info можно посмотреть","operationId":"set_device_health_check_interval_device__device_id__health_check_interval__interval__put","parameters":[{"name":"device_id","in":"path","required":true,"schema":{"type":"integer","title":"Device Id"}},{"name":"interval","in":"path","required":true,"schema":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Interval"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/device/{device_id}/delete":{"delete":{"summary":"Delete Device","operationId":"delete_device_device__device_id__delete_delete","parameters":[{"name":"device_id","in":"path","required":true,"schema":{"type":"integer","title":"Device Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/device/{device_id}/settings":{"get":{"summary":"Get Device Settings","description":"Вернуть настройки устройства","operationId":"get_device_settings_device__device_id__settings_get","parameters":[{"name":"device_id","in":"path","required":true,"schema":{"type":"integer","title":"Device Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeviceSettingsInfo"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/device/{device_id}/settings/update":{"put":{"summary":"Update Device Settings","description":"Обновить настройки устройства.  Допускается неполное обновление (только части полей)","operationId":"update_device_settings_device__device_id__settings_update_put","parameters":[{"name":"device_id","in":"path","required":true,"schema":{"title":"Device Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeviceSettingsInfo"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/device/{device_id}/settings/update_field":{"put":{"summary":"Update Device Settings Field","operationId":"update_device_settings_field_device__device_id__settings_update_field_put","parameters":[{"name":"device_id","in":"path","required":true,"schema":{"title":"Device Id"}},{"name":"fld_name","in":"query","required":true,"schema":{"type":"string","title":"Fld Name"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"anyOf":[{},{"type":"null"}],"title":"Fld Value"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/device/{device_id}/settings_schema":{"get":{"summary":"Get Device Settings Schema","description":"Вернуть схему настроек устройства (имена параметров, типы данных, обязательность и т.д.)","operationId":"get_device_settings_schema_device__device_id__settings_schema_get","parameters":[{"name":"device_id","in":"path","required":true,"schema":{"type":"integer","title":"Device Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/DeviceParamInfo"},"title":"Response Get Device Settings Schema Device  Device Id  Settings Schema Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"Body_create_management_process":{"properties":{"sample_format":{"anyOf":[{"$ref":"#/components/schemas/TelemetrySampleFormat"},{"type":"null"}]},"sampling_interval":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Sampling Interval"}},"type":"object","title":"Body_create_management_process"},"DeviceInfo":{"properties":{"device_id":{"type":"integer","title":"Device Id","description":"ID устройства в рамках своего сервиса (разные сервисы устройств будут смотреть на разные схемы БД)"},"device_uuid":{"type":"string","format":"uuid","title":"Device Uuid","description":"Идентификатор устройства, глобально уникальный для каждого конкретного устройства, даже разных производителей и сервисов"},"name":{"type":"string","title":"Name","description":"Короткое и удобное имя устройства"},"display_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Display Name","description":"Более подробное название, для отображения в интерфейсе"},"model_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Model Name","description":"Модель устройства (например, DS18B20)"},"device_type":{"$ref":"#/components/schemas/DeviceType","description":"Тип устройства","default":"OTHER"},"url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Url","description":"URL для доступа к устройства, если применимо"},"min_health_check_interval":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Min Health Check Interval","description":"Минимальный интервал между проверками работоспособности устройства"},"last_health_check":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Last Health Check","description":"Время последней успешной проверки работоспособности"},"is_active":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Is Active","description":"Включен/выключен (если его можно переводить в спящий режим без отключения от сети)","default":false},"is_alive":{"type":"boolean","title":"Is Alive","description":"Доступно ли устройство по сети (если умеет это показывать отдельно от запроса на измерения)","default":false}},"additionalProperties":true,"type":"object","required":["device_id","device_uuid","name"],"title":"DeviceInfo","description":"Информация об устройстве"},"DeviceParamDataType":{"type":"string","enum":["INT","FLOAT","BOOL","TEXT","JSON"],"title":"DeviceParamDataType","description":"Типы данных для отдельных настроек устройства"},"DeviceParamInfo":{"properties":{"name":{"type":"string","title":"Name","description":"Идентификатор поля в настройках (например, 'cutoff_voltage')"},"display_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Display Name","description":"Человекочитаемое название поля для отображения в интерфейсе, например, \"Напряжение отсечки\""},"required":{"type":"boolean","title":"Required","description":"Флажок, что поле обязательное"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description","description":"Подробное описание поля"},"data_type":{"$ref":"#/components/schemas/DeviceParamDataType","description":"Тип данных поля","default":"JSON"},"min_value":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Min Value","description":"Минимальное допустимое значение (для числовых типов)"},"max_value":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Max Value","description":"Максимальное допустимое значение (для числовых типов)"},"allowed_values":{"anyOf":[{"items":{},"type":"array"},{"type":"null"}],"title":"Allowed Values","description":"Список допустимых значений (если поле может принимать только определённые значения)"},"default_value":{"anyOf":[{},{"type":"null"}],"title":"Default Value","description":"Значение по умолчанию (если поле не required)"}},"type":"object","required":["name","required"],"title":"DeviceParamInfo","description":"Метаданные: спецификация полей настроек устройства\n\nСодержит метаданные для генерации:\n- дефолтного виджета настроек устройства;\n- дефолтной формы добавления нового устройства (там набор может быть отличаться от набора настроек, это важно!)"},"DeviceSettingsInfo":{"properties":{},"additionalProperties":true,"type":"object","title":"DeviceSettingsInfo","description":"Словарь с настройками датчика. Структура зависит от конкретной модели датчика."},"DeviceType":{"type":"string","enum":["SENSOR","ACTUATOR","OTHER"],"title":"DeviceType"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"MeasurementProcessInfo":{"properties":{"sensor_id":{"type":"integer","title":"Sensor Id","description":"Идентификатор датчика, к которому относится процесс измерения"},"sample_format":{"$ref":"#/components/schemas/TelemetrySampleFormat","description":"Формат данных, в котором датчик возвращает измерения"},"started_at":{"type":"string","format":"date-time","title":"Started At","description":"Время запуска процесса измерения"},"stopped_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Stopped At","description":"Время остановки процесса измерения (None, если процесс ещё выполняется)"},"sampling_interval":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Sampling Interval","description":"Интервал между измерениями в секундах. Может быть None, если датчик сам посылает данные по необходимости"}},"type":"object","required":["sensor_id","sample_format"],"title":"MeasurementProcessInfo","description":"Информация о процессе измерения, запущенном на датчике.\nНа одном датчике может быть запущено несколько процессов измерения одновременно."},"SensorInfo":{"properties":{"device_id":{"type":"integer","title":"Device Id","description":"ID устройства в рамках своего сервиса (разные сервисы устройств будут смотреть на разные схемы БД)"},"device_uuid":{"type":"string","format":"uuid","title":"Device Uuid","description":"Идентификатор устройства, глобально уникальный для каждого конкретного устройства, даже разных производителей и сервисов"},"name":{"type":"string","title":"Name","description":"Короткое и удобное имя устройства"},"display_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Display Name","description":"Более подробное название, для отображения в интерфейсе"},"model_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Model Name","description":"Модель устройства (например, DS18B20)"},"device_type":{"$ref":"#/components/schemas/DeviceType","description":"Тип устройства","default":"OTHER"},"url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Url","description":"URL для доступа к устройства, если применимо"},"min_health_check_interval":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Min Health Check Interval","description":"Минимальный интервал между проверками работоспособности устройства"},"last_health_check":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Last Health Check","description":"Время последней успешной проверки работоспособности"},"is_active":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Is Active","description":"Включен/выключен (если его можно переводить в спящий режим без отключения от сети)","default":false},"is_alive":{"type":"boolean","title":"Is Alive","description":"Доступно ли устройство по сети (если умеет это показывать отдельно от запроса на измерения)","default":false},"sensor_type":{"$ref":"#/components/schemas/SensorType","description":"Тип датчика (температура, CO2 и т.д.)","default":"OTHER"},"needs_polling":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Needs Polling","description":"Требуется ли опрашивать датчик (true) или он сам отправляет данные (false)"},"min_sampling_interval":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Min Sampling Interval","description":"Минимальный интервал между опросами датчика в секундах"}},"additionalProperties":true,"type":"object","required":["device_id","device_uuid","name"],"title":"SensorInfo","description":"Информация о датчике в системе."},"SensorType":{"type":"string","enum":["TEMPERATURE","POWER_CONSUMPTION","CO2","SMOKE","LEAK","FLUID_FLOW","OTHER"],"title":"SensorType","description":"Тип датчика"},"TelemetrySampleFormat":{"type":"string","enum":["CUSTOM","FLOAT_WITH_TIMESTAMP","FLOAT_BINARY","INT","BOOL","TEXT"],"title":"TelemetrySampleFormat","description":"В каком формате заливать телеметрию в очередь.\nNB: FLOAT_WITH_TIMESTAMP и FLOAT потом будует конвертироваться в один и тот же класс FloatTelemetrySample)"},"TelemetrySampleInfo":{"properties":{"timestamp":{"type":"string","format":"date-time","title":"Timestamp"},"value":{"anyOf":[{},{"type":"null"}],"title":"Value"}},"type":"object","title":"TelemetrySampleInfo","description":"Базовый класс для отдельных измерений телеметрии в процессе измерений."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}